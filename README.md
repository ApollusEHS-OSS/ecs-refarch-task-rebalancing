# Rebalancing Amazon ECS Tasks using AWS Lambda##Introduction In this reference architecture, we will demonstrate a serverless approach using AWS Lambda and Amazon ECS Event Stream to proactively rebalance the ECS tasks.### Create an ECS Cluster and Deploy a Sample App For your convenience, we have created a CloudFormation template that will create the core infrastructure that we will use throughout this blog. *	Create a new Stack from the AWS Console use the following template URL: <https://link.tbd>*	Confirm that the stack creates successfully. Under the Outputs tab, you’ll find the Application URL listed as ECSALB. Cut and paste this into your browser. 	**You should see a Congratulations page confirming that your ECS Service is running as expected.**### Explore the ECS Cluster* Review Settings in the ECS Console*  Scale Down the ECS Cluster Size to **1** using the desired count in the Auto Scaling Group Settings* Verify that the Site is up, and services are are located on a single node.*	Change the ASG desired count back to **2***	Observe that Tasks did not balance across both nodes. This is the default behavior of ECS.### Use ECS Events to Rebalance TasksWe propose a solution that listens to “ECS Container Instance State Change” events on the ECS event stream and triggers a lambda that rebalances tasks on the ECS cluster. DiagramThis involves:1.	Creating a Lambda function that will rebalance tasks on ECS cluster by updating the service deployed on the cluster.  2.	Creating a Cloud Watch Event, that uses “ECS Container Instance State Change” event from the ECS event stream as a trigger to execute the lambda function that rebalances the tasks.### Create the Lambda FunctionLambda Overview```Lambda Function with Comments```### Deploy the Lambda Function
1. Create an S3 Bucket
2. Upload the zip file containing the Lambda function.

A CloudFormation template has been provided to configure the Lambda Function and CloudWatch Triggers.
### Scale the Cluster and Validate Task Rebalancing1.	Repeat the scaling tasks from before to scale down the cluster2.	Check Lambda / CWE3.	Verify Placement4.	Scale Up5.	Check Lambda / CWE6.	Verify Placement